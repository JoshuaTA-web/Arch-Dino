<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Arch-Dino</title>
  <style>
    canvas {
      background: #f0f0f0;
      display: block;
      margin: 0 auto;
      border: 2px solid #333;
    }
    #restartBtn {
      display: none;
      margin: 10px auto;
      padding: 10px 20px;
      background-color: #333;
      color: #fff;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    #scoreBoard {
      text-align: center;
      font-family: sans-serif;
      font-size: 18px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="300"></canvas>
<div id="scoreBoard">Score: <span id="score">0</span></div>
<button id="restartBtn">Restart Game</button>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const restartBtn = document.getElementById('restartBtn');
  const scoreDisplay = document.getElementById('score');

  let dino = { x: 50, y: 250, width: 50, height: 50, vy: 0, gravity: 1.5, isJumping: false };
  let obstacles = [];
  let backgroundElements = [];
  let score = 0;
  let gameOver = false;

  const dinoImg = new Image();
  dinoImg.src = 'archdino.png';

  const obstacleImages = {
    box: new Image(),
    cone: new Image(),
    sign: new Image(),
    chair: new Image()
  };

  obstacleImages.box.src = 'box.png';
  obstacleImages.cone.src = 'cone.png';
  obstacleImages.sign.src = 'deadline.png';
  obstacleImages.chair.src = 'chair.png';

  const skyline = new Image();
  skyline.src = 'skyline.png'; // custom background image (skyline)

  const crane = new Image();
  crane.src = 'crane.png'; // optional occasional background crane hook

  const jumpSound = new Audio('jump.mp3');
  const crashSound = new Audio('crash.mp3');

  function resetGame() {
    dino.y = 250;
    dino.vy = 0;
    obstacles = [];
    backgroundElements = [];
    score = 0;
    gameOver = false;
    restartBtn.style.display = 'none';
    loop();
  }

  function createObstacle() {
    const types = ['box', 'cone', 'sign', 'chair'];
    const type = types[Math.floor(Math.random() * types.length)];

    obstacles.push({
      x: canvas.width,
      y: 260,
      width: 40,
      height: 40,
      type: type
    });
  }

  function drawObstacles() {
    obstacles.forEach(obs => {
      ctx.drawImage(obstacleImages[obs.type], obs.x, obs.y, obs.width, obs.height);
      obs.x -= 5;
    });
    obstacles = obstacles.filter(obs => obs.x + obs.width > 0);
  }

  function drawBackground() {
    // skyline moves slower for parallax effect
    backgroundElements.forEach((bg, index) => {
      ctx.drawImage(skyline, bg.x, 200, 800, 100);
      bg.x -= 2;
    });
    if (backgroundElements.length === 0 || backgroundElements[backgroundElements.length - 1].x <= 0) {
      backgroundElements.push({ x: canvas.width });
    }
    backgroundElements = backgroundElements.filter(bg => bg.x + 800 > 0);

    // occasionally draw crane
    if (score % 800 === 0 && !gameOver) {
      ctx.drawImage(crane, 600, 0, 40, 100);
    }
  }

  function detectCollision() {
    for (let obs of obstacles) {
      if (
        dino.x < obs.x + obs.width &&
        dino.x + dino.width > obs.x &&
        dino.y < obs.y + obs.height &&
        dino.y + dino.height > obs.y
      ) {
        crashSound.play();
        return true;
      }
    }
    return false;
  }

  function drawDino() {
    ctx.drawImage(dinoImg, dino.x, dino.y, dino.width, dino.height);
  }

  function loop() {
    if (gameOver) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawBackground();

    dino.y += dino.vy;
    dino.vy += dino.gravity;
    if (dino.y > 250) {
      dino.y = 250;
      dino.vy = 0;
      dino.isJumping = false;
    }

    drawDino();
    drawObstacles();

    if (detectCollision()) {
      gameOver = true;
      restartBtn.style.display = 'block';
      return;
    }

    score++;
    scoreDisplay.innerText = Math.floor(score / 10);

    if (score % 150 === 0) {
      createObstacle();
    }

    requestAnimationFrame(loop);
  }

  document.addEventListener('keydown', function (e) {
    if (e.code === 'Space') {
      if (gameOver) {
        resetGame();
      } else if (!dino.isJumping) {
        dino.vy = -20;
        dino.isJumping = true;
        jumpSound.play();
      }
    }
  });

  restartBtn.addEventListener('click', resetGame);

  dinoImg.onload = function () {
    loop();
  };
</script>

</body>
</html>
